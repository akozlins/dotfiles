#!/bin/bash
set -euf

DOTFILES="${DOTFILES:-$HOME/.dotfiles}"
[ -d "$DOTFILES" ] && export HOME="$DOTFILES"

if [ ! -f "$XDG_DATA_HOME/code/User/settings.json" ] ; then
    mkdir -- "$XDG_DATA_HOME/code/User"
    ln -s "$XDG_CONFIG_HOME/code/User/settings.json" "$XDG_DATA_HOME/code/User/settings.json"
fi

CMD=(
    /usr/bin/code
    --user-data-dir "$XDG_DATA_HOME/code"
    --extensions-dir "$XDG_DATA_HOME/code/extensions"
    "$@"
)

[ $# -gt 0 ] && exec "${CMD[@]}"
exec "${CMD[@]}" &> /dev/null &
