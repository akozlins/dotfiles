#!/bin/bash
set -euf

export HOME="$DOTFILES"

if [ ! -f "$XDG_DATA_HOME/code/User/settings.json" ] ; then
    mkdir -- "$XDG_DATA_HOME/code/User"
    ln -s "$XDG_CONFIG_HOME/code/User/settings.json" "$XDG_DATA_HOME/code/User/settings.json"
fi

CMD=(
    "/bin/code"
    --user-data-dir "$XDG_DATA_HOME/code"
    --extensions-dir "$XDG_DATA_HOME/code/extensions"
    "$@"
)

if [ $# -eq 0 ] ; then
    exec "${CMD[@]}" > /dev/null 2>&1 &
else
    exec "${CMD[@]}"
fi
