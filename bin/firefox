#!/bin/bash
set -euf

unset CDPATH
cd "$HOME" || exit 1

profile="$XDG_CONFIG_HOME/firefox/default"

if [ ! -f "$profile/prefs.js" ] ; then
    echo "ERROR: profile '$profile' not found"
    exit 1
fi

CMD=("/usr/bin/firefox" --profile "$profile" "$@")

FJ="/usr/bin/firejail"
[ -x "$FJ" ] && CMD=("$FJ" "--profile=$XDG_CONFIG_HOME/firejail/firefox.profile" -- "${CMD[@]}")

if [ $# -eq 0 ] ; then
  exec "${CMD[@]}" > /dev/null 2>&1 &
else
  exec "${CMD[@]}"
fi
