#!/bin/sh
set -euf

unset CDPATH
cd "$HOME" || exit 1

profile="$XDG_CONFIG_HOME/firefox/default"

if [ ! -f "$profile/prefs.js" ] ; then
    echo "ERROR: profile '$profile' not found"
    exit 1
fi

FJ="/usr/bin/firejail"
CMD="/usr/bin/firefox-esr --profile $profile"

[ -x "$FJ" ] && CMD="$FJ --profile=$XDG_CONFIG_HOME/firejail/firefox.profile -- $CMD"

if [ $# -eq 0 ] ; then
  exec $CMD "$@" > /dev/null 2>&1 &
else
  exec $CMD "$@"
fi
