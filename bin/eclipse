#!/bin/bash
set -eu

if [ -z "${DVT_LICENSE_FILE:+x}" ] ; then
    export DVT_LICENSE_FILE=
fi

export SWT_GTK3=0

CMD=(
    "/bin/eclipse"
    -configuration "$XDG_CACHE_HOME/eclipse/config"
    -data "$XDG_CONFIG_HOME/eclipse/data"
    --launcher.GTK_version 2
    -vmargs
        "-Duser.home=$XDG_CACHE_HOME/eclipse"
        # DVT
        "-XX:CompileCommand=exclude,org/eclipse/core/internal/dtree/DataTreeNode,forwardDeltaWith"
        "-XX:CompileCommand=exclude,ro/amiq/edt/ui/editor/rules/ECommentTaskRule,evaluate"
        "-XX:CompileCommand=exclude,ro/amiq/edt/ui/editor/rules/EMethodRule,evaluate"
        "-XX:CompileCommand=exclude,ro/amiq/vhdldt/ui/editor/rules/VhdlCommentTaskRule,evaluate"
        "-XX:CompileCommand=exclude,ro/amiq/vlogdt/ui/editor/rules/VlogCombinedWordRule,evaluate"
        "-XX:CompileCommand=exclude,ro/amiq/vlogdt/ui/editor/rules/VlogCommentTaskRule,evaluate"
        "-XX:CompileCommand=exclude,ro/amiq/vlogdt/parser/VlogParser,class_declaration"
        "-XX:CompileCommand=exclude,ro/amiq/edt/model/reflection/Determinant,contains"
    "$@"
)

if [ $# -eq 0 ] ; then
    exec "${CMD[@]}" > /dev/null 2>&1 &
else
    exec "${CMD[@]}"
fi
